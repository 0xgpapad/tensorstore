

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>downsample Driver &mdash; TensorStore  documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/sphinx_rtd_theme_table_word_wrap_fix.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"displayAlign": "left"})</script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="array Driver" href="../array/index.html" />
    <link rel="prev" title="cast Driver" href="../cast/index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> TensorStore
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Building and Installing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../environment.html">Environment variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../index_space.html">Index space</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../context.html">Context framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../spec.html">TensorStore JSON Spec</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Drivers</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../cast/index.html"><code class="docutils literal notranslate"><span class="pre">cast</span></code> Driver</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#"><code class="docutils literal notranslate"><span class="pre">downsample</span></code> Driver</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#json-schema">JSON Schema</a></li>
<li class="toctree-l3"><a class="reference internal" href="#downsample-method-json-schema">Downsample method JSON Schema</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../array/index.html"><code class="docutils literal notranslate"><span class="pre">array</span></code> Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#single-file-drivers">Single file drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#chunked-storage-drivers">Chunked storage drivers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../kvstore/index.html">Key-Value Storage Layer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../python/index.html">Python API</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">TensorStore</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Drivers</a> &raquo;</li>
        
      <li><code class="docutils literal notranslate"><span class="pre">downsample</span></code> Driver</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="downsample-driver">
<h1><code class="docutils literal notranslate"><span class="pre">downsample</span></code> Driver<a class="headerlink" href="#downsample-driver" title="Permalink to this headline">¶</a></h1>
<p>Virtual read-only view that performs downsampling.</p>
<p>Downsampling is performed on-the-fly to compute exactly the positions of the
downsampled view that are read.</p>
<div class="section" id="json-schema">
<span id="json-schema-https://github.com/google/tensorstore/json-schema/driver/downsample"></span><h2>JSON Schema<a class="headerlink" href="#json-schema" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">object</span></code> with members:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 0%" />
<col style="width: 100%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">driver</span></code><div class="docutils container">
<strong>Required</strong></div>
</td>
<td><div class="docutils container">
<code class="code highlight json docutils literal notranslate"><span class="literal string double"><span class="pre">“downsample”</span></span></code></div>
</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">context</span></code></td>
<td><div class="docutils container">
<span><a class="reference internal" href="../../../context.html#json-schema-https://github.com/google/tensorstore/json-schema/context"><span class="std std-ref">Context</span></a></span></div>
<p>Specifies context resources that augment/override the parent context.</p>
</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">dtype</span></code></td>
<td><div class="docutils container">
<span><a class="reference internal" href="../../../spec.html#json-schema-https://github.com/google/tensorstore/json-schema/dtype"><span class="std std-ref">Data type</span></a></span></div>
<p>Specifies the data type.</p>
</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">rank</span></code></td>
<td><div class="docutils container">
integer [0, ∞)</div>
</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">transform</span></code></td>
<td><div class="docutils container">
<span><a class="reference internal" href="../../../index_space.html#json-schema-https://github.com/google/tensorstore/json-schema/index-transform"><span class="std std-ref">Index transform</span></a></span></div>
<p>Specifies a transform.</p>
</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">base</span></code><div class="docutils container">
<strong>Required</strong></div>
</td>
<td><div class="docutils container">
<span><a class="reference internal" href="../../../spec.html#json-schema-https://github.com/google/tensorstore/json-schema/tensorstore"><span class="std std-ref">TensorStore</span></a></span></div>
<span>Base TensorStore to downsample.  </span><p>Downsampling is always performed with respect to an origin of 0 in all
dimensions in the <code class="docutils literal notranslate"><span class="pre">base</span></code> TensorStore.  To use a different
origin, translate the domain by specifying an
<a class="reference internal" href="../../../index_space.html#json-schema-https://github.com/google/tensorstore/json-schema/index-transform"><span class="std std-ref">Index transform</span></a>
via the <code class="docutils literal notranslate"><span class="pre">transform</span></code> property of <code class="docutils literal notranslate"><span class="pre">base</span></code>.</p>
<p>Translating the domain of the downsampled view by a given <code class="docutils literal notranslate"><span class="pre">offset</span></code> is
equivalent to translating the domain of <code class="docutils literal notranslate"><span class="pre">base</span></code> by <code class="docutils literal notranslate"><span class="pre">offset</span>
<span class="pre">*</span> <span class="pre">downsample_factors</span></code>.  However, there is no translation of the
downsampled view that is exactly equivalent to translating the domain of
<code class="docutils literal notranslate"><span class="pre">base</span></code> by an offset that is not a multiple of
<code class="docutils literal notranslate"><span class="pre">downsample_factors</span></code>.</p>
</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">downsample_factors</span></code><div class="docutils container">
<strong>Required</strong></div>
</td>
<td><div class="docutils container">
array of integer [1, ∞)</div>
<p>Factors by which to downsample each dimension of <code class="docutils literal notranslate"><span class="pre">base</span></code>.
The length must match the rank of <code class="docutils literal notranslate"><span class="pre">base</span></code>.  Specifying a
factor of 1 indicates not to downsample a given dimension.</p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">Example</span><a class="headerlink" href="#id1" title="Permalink to this code">¶</a></div>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
</pre></div>
</div>
</div>
</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">downsample_method</span></code><div class="docutils container">
<strong>Required</strong></div>
</td>
<td><div class="docutils container">
<span><a class="reference internal" href="#json-schema-https://github.com/google/tensorstore/json-schema/driver/downsample#method"><span class="std std-ref">Downsample method</span></a></span></div>
</td>
</tr>
</tbody>
</table>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">Example</span><a class="headerlink" href="#id2" title="Permalink to this code">¶</a></div>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> 
  <span class="nt">&quot;driver&quot;</span><span class="p">:</span> <span class="s2">&quot;downsample&quot;</span><span class="p">,</span>
  <span class="nt">&quot;downsample_factors&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
  <span class="nt">&quot;downsample_method&quot;</span><span class="p">:</span> <span class="s2">&quot;mean&quot;</span><span class="p">,</span>
  <span class="nt">&quot;base&quot;</span><span class="p">:</span> <span class="p">{</span><span class="nt">&quot;driver&quot;</span><span class="p">:</span> <span class="s2">&quot;zarr&quot;</span><span class="p">,</span> <span class="nt">&quot;kvstore&quot;</span><span class="p">:</span> <span class="p">{</span><span class="nt">&quot;driver&quot;</span><span class="p">:</span> <span class="s2">&quot;gcs&quot;</span><span class="p">,</span> <span class="nt">&quot;bucket&quot;</span><span class="p">:</span> <span class="s2">&quot;my-bucket&quot;</span><span class="p">}}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p>The following downsampling methods are supported:</p>
<div class="section" id="downsample-method-json-schema">
<span id="json-schema-https://github.com/google/tensorstore/json-schema/driver/downsample#method"></span><h2>Downsample method JSON Schema<a class="headerlink" href="#downsample-method-json-schema" title="Permalink to this headline">¶</a></h2>
<div class="docutils container">
<code class="code highlight json docutils literal notranslate"><span class="literal string double"><span class="pre">“stride”</span></span></code> | <code class="code highlight json docutils literal notranslate"><span class="literal string double"><span class="pre">“median”</span></span></code> | <code class="code highlight json docutils literal notranslate"><span class="literal string double"><span class="pre">“mode”</span></span></code> | <code class="code highlight json docutils literal notranslate"><span class="literal string double"><span class="pre">“mean”</span></span></code> | <code class="code highlight json docutils literal notranslate"><span class="literal string double"><span class="pre">“min”</span></span></code> | <code class="code highlight json docutils literal notranslate"><span class="literal string double"><span class="pre">“max”</span></span></code></div>
<div class="docutils container">
One of:</div>
<ul>
<li><div class="docutils container">
<code class="code highlight json docutils literal notranslate"><span class="literal string double"><span class="pre">“stride”</span></span></code></div>
<p>Downsampling is performed by striding: reading a given position
<code class="docutils literal notranslate"><span class="pre">position</span></code> in the downsampled view is exactly equivalent to
reading <code class="docutils literal notranslate"><span class="pre">position</span> <span class="pre">*</span> <span class="pre">downsample_factors</span></code> in the original view.
This method supports all data types and is quite efficient (there is
no additional buffering of data).  It is equivalent to applying a
striding index transform to <code class="docutils literal notranslate"><span class="pre">base</span></code>; while it offers no
additional functionality, it offers uniformity with other methods
and may be simpler to specify.</p>
<p>Note that striding is always with respect to an origin of 0 in all
dimensions.  For example, downsampling a 1-dimensional TensorStore
with a factor of 3 reads from positions <code class="docutils literal notranslate"><span class="pre">0</span></code>, <code class="docutils literal notranslate"><span class="pre">3</span></code>, <code class="docutils literal notranslate"><span class="pre">6</span></code>, etc.
To use a different offset, translate the domain of
<code class="docutils literal notranslate"><span class="pre">base</span></code>.</p>
</li>
<li><div class="docutils container">
<code class="code highlight json docutils literal notranslate"><span class="literal string double"><span class="pre">“median”</span></span></code></div>
<p>Downsampling computes the median value: reading a given <code class="docutils literal notranslate"><span class="pre">position</span></code>
in the downsampled view returns the median value within the
rectangular region <code class="docutils literal notranslate"><span class="pre">[position</span> <span class="pre">*</span> <span class="pre">downsample_factors,</span> <span class="pre">(position</span> <span class="pre">+</span> <span class="pre">1)</span>
<span class="pre">*</span> <span class="pre">downsample_factors)</span></code> of the original view.  Only non-complex
numeric data types and bool are supported.  The computed median
value is always a value present in the original data.  In the case
that the rectangular region contains an odd number of elements, the
lower value is always used.  For example, the median computed for
<code class="code highlight json docutils literal notranslate"><span class="punctuation"><span class="pre">[</span></span><span class="literal number float"><span class="pre">4.0</span></span><span class="punctuation"><span class="pre">,</span></span> <span class="literal number float"><span class="pre">3.0</span></span><span class="punctuation"><span class="pre">,</span></span> <span class="literal number float"><span class="pre">1.0</span></span><span class="punctuation"><span class="pre">,</span></span> <span class="literal number float"><span class="pre">2.0</span></span><span class="punctuation"><span class="pre">]</span></span></code> is <code class="code highlight json docutils literal notranslate"><span class="literal number float"><span class="pre">2.0</span></span></code>.</p>
</li>
<li><div class="docutils container">
<code class="code highlight json docutils literal notranslate"><span class="literal string double"><span class="pre">“mode”</span></span></code></div>
<p>Downsampling computes the mode (most frequent value): reading a
given <code class="docutils literal notranslate"><span class="pre">position</span></code> in the downsampled view returns the mode within
the rectangular region <code class="docutils literal notranslate"><span class="pre">[position</span> <span class="pre">*</span> <span class="pre">downsample_factors,</span> <span class="pre">(position</span> <span class="pre">+</span>
<span class="pre">1)</span> <span class="pre">*</span> <span class="pre">downsample_factors)</span></code> of the original view.  All data types are
supported.  In the case of a tie, for non-complex numeric data types
and bool, the lowest value (among the set of common frequent values)
is chosen.  For strings, the lexicographically smallest value is
chosen.  For other data types, an unspecified (but deterministic for
a given version of TensorStore) most frequent value is chosen.</p>
</li>
<li><div class="docutils container">
<code class="code highlight json docutils literal notranslate"><span class="literal string double"><span class="pre">“mean”</span></span></code></div>
<p>Downsampling is performed by arithmetic mean (averaging): reading a
given <code class="docutils literal notranslate"><span class="pre">position</span></code> in the downsampled view returns the arithmetic
mean within the rectangular region <code class="docutils literal notranslate"><span class="pre">[position</span> <span class="pre">*</span> <span class="pre">downsample_factors,</span>
<span class="pre">(position</span> <span class="pre">+</span> <span class="pre">1)</span> <span class="pre">*</span> <span class="pre">downsample_factors)</span></code> of the original view, where
the average is computed only over positions that are within the
bounds of the original view.  Only numeric data types and
<code class="code highlight json docutils literal notranslate"><span class="literal string double"><span class="pre">“bool”</span></span></code> are supported.  For integer data types, the means are
computed exactly and rounded to the nearest integer, and rounded to
even in the case of a tie.  For the <code class="code highlight json docutils literal notranslate"><span class="literal string double"><span class="pre">“bool”</span></span></code> data type, the
mode is chosen.</p>
<p>Note that the blocks used for averaging start with an origin of 0 in
all dimensions.  For example, downsampling a 1-dimensional
TensorStore with a downsample factor of 3 averages the intervals
<code class="docutils literal notranslate"><span class="pre">[0,</span> <span class="pre">3)</span></code>, <code class="docutils literal notranslate"><span class="pre">[3,</span> <span class="pre">6)</span></code>, <code class="docutils literal notranslate"><span class="pre">[6,</span> <span class="pre">9)</span></code>, etc.  To use a different offset,
translate the domain of <code class="docutils literal notranslate"><span class="pre">base</span></code>.</p>
</li>
<li><div class="docutils container">
<code class="code highlight json docutils literal notranslate"><span class="literal string double"><span class="pre">“min”</span></span></code></div>
<p>Downsampling computes the minimum value: reading a given
<code class="docutils literal notranslate"><span class="pre">position</span></code> in the downsampled view returns the minimum value
within the rectangular region <code class="docutils literal notranslate"><span class="pre">[position</span> <span class="pre">*</span> <span class="pre">downsample_factors,</span>
<span class="pre">(position</span> <span class="pre">+</span> <span class="pre">1)</span> <span class="pre">*</span> <span class="pre">downsample_factors)</span></code> of the original view.  Only
non-complex numeric data types and bool are supported.</p>
</li>
<li><div class="docutils container">
<code class="code highlight json docutils literal notranslate"><span class="literal string double"><span class="pre">“max”</span></span></code></div>
<p>Downsampling computes the maximum value: reading a given
<code class="docutils literal notranslate"><span class="pre">position</span></code> in the downsampled view returns the maximum value
within the rectangular region <code class="docutils literal notranslate"><span class="pre">[position</span> <span class="pre">*</span> <span class="pre">downsample_factors,</span>
<span class="pre">(position</span> <span class="pre">+</span> <span class="pre">1)</span> <span class="pre">*</span> <span class="pre">downsample_factors)</span></code> of the original view.  Only
non-complex numeric data types and bool are supported.</p>
</li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="../array/index.html" class="btn btn-neutral float-right" title="array Driver" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="../cast/index.html" class="btn btn-neutral float-left" title="cast Driver" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2020 The TensorStore Authors.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>